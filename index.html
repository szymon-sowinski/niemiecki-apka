<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Nauka niemieckiego ‚Äì Aplikacja</title>
<style>
    /* Og√≥lne */
    body {
        font-family: Arial, sans-serif;
        background: #eef2f3;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: 10px;
        box-sizing: border-box;
    }

    #app {
        width: 100%;
        max-width: 480px;
        background: white;
        padding: 20px;
        border-radius: 18px;
        box-shadow: 0 0 25px rgba(0,0,0,0.15);
        text-align: center;
        box-sizing: border-box;
    }

    h2 { margin-bottom: 20px; font-size: 1.5rem; }

    button {
        padding: 12px 16px;
        font-size: 16px;
        margin: 6px 0;
        width: 100%;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        background: #007bff;
        color: white;
        box-sizing: border-box;
    }
    button:hover { background: #0056b3; }

    .back {
        background: #444 !important;
        margin-top: 12px;
    }

    .word { font-size: 1.5rem; font-weight: bold; margin-bottom: 10px; word-wrap: break-word; }
    .translation { font-size: 1.2rem; margin: 10px 0; color: #333; word-wrap: break-word; }
    .option { background: #ddd; color: black; }
    .correct { background: #4caf50 !important; color: white !important; }
    .wrong { background: #f44336 !important; color: white !important; }

    .small { font-size: 0.9rem; color: #666; margin-bottom: 10px; }
    .example { margin-top: 10px; color: #444; font-style: italic; word-wrap: break-word; }

    /* Przyciski do niemieckich znak√≥w */
    .char-btn {
        width: 45px;
        padding: 8px 0;
        margin: 2px 3px 8px 3px;
        font-size: 16px;
        box-sizing: border-box;
    }

    input[type="text"] {
        padding: 10px;
        width: 100%;
        font-size: 16px;
        box-sizing: border-box;
        margin-bottom: 10px;
    }

    /* Intelligent Feedback Box */
    #intelligentBoxOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0,0,0,0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 10px;
        box-sizing: border-box;
    }

    #intelligentBox {
        background: white;
        padding: 20px 25px;
        border-radius: 15px;
        max-width: 400px;
        width: 100%;
        box-shadow: 0 0 20px rgba(0,0,0,0.3);
        text-align: center;
        font-family: Arial, sans-serif;
    }
    #intelligentBox .word { font-size: 1.5rem; margin-bottom: 8px; }
    #intelligentBox .translation { font-size: 1.2rem; color: #333; margin-bottom: 15px; }
    #intelligentBox .additionalInfo { font-size: 1rem; color: #555; font-style: italic; }

    @media (max-width: 480px) {
        #app {
            transform: scale(1.3);
            transform-origin: top center;
        }
    }
</style>
</head>
<body>
<div id="app"></div>

<script>
// -------------------------
// BAZA S≈Å√ìWEK
// -------------------------
const words = [
["das Abi","matura","",""],
["die Anzeige","og≈Çoszenie","",""],
["die Arbeitsstunde","godzina pracy","",""],
["die Aushilfe","pomoc, pomocnik","",""],
["au√üerdem","opr√≥cz tego","",""],
["ohne Barrieren","bez barier","",""],
["der Bereich","zakres, obszar","",""],
["die Berufs- und Studienorientierung","orientacja dotyczƒÖca zawodu i kierunku studi√≥w","",""],
["das Berufsinformationszentrum","centrum orientacji zawodowej","",""],
["die Bewerbung","podanie o pracƒô","",""],
["die Bezahlung","zap≈Çata","",""],
["der Briefumschlag","koperta","",""],
["darum","dlatego","",""],
["der Diebstahl","kradzie≈º","",""],
["die Eisdiele","lodziarnia","",""],
["der Fahrgast","pasa≈ºer","",""],
["die Ferienschwimmschule","letnia szk√≥≈Çka p≈Çywania","",""],
["sich Gedanken machen","zastanawiaƒá siƒô","",""],
["die Gerechtigkeit","sprawiedliwo≈õƒá","",""],
["das Gericht","sƒÖd","",""],
["die Hektik","po≈õpiech","",""],
["der Held","bohater","",""],
["im In- und Ausland","w kraju i za granicƒÖ","",""],
["das Jura","prawo (kierunek studi√≥w)","",""],
["das Klischee","stereotyp","",""],
["den Knopf dr√ºcken","naciskaƒá guzik","",""],
["Kontakte aufnehmen","nawiƒÖzywaƒá kontakty","",""],
["der Kopierer","kopiarka","",""],
["der Kriminalfall","sprawa kryminalna","",""],
["der Kunde","klient","",""],
["die Pr√ºfung","egzamin","",""],
["im Rahmen","w ramach","",""],
["die Saisonstelle","posada sezonowa","",""],
["die Schichtarbeit","praca w systemie zmianowym","",""],
["schlie√ülich","w ko≈Ñcu","",""],
["der Schulabschluss","uko≈Ñczenie szko≈Çy","",""],
["die Schw√§che","s≈Çaba strona, s≈Çabo≈õƒá","",""],
["das Softwareprogramm entwickeln","opracowywaƒá oprogramowanie","",""],
["die Sommersaison","sezon letni","",""],
["sonst","w przeciwnym razie","",""],
["die Sportakademie","Akademia Sportu","",""],
["das Sportmanagement","kierownictwo sportu","",""],
["die St√§rke","mocna strona","",""],
["St√§rken zeigen","pokazywaƒá mocne strony","",""],
["die Stelle","posada","",""],
["mit Stress umgehen","obchodziƒá siƒô ze stresem","",""],
["das Studienangebot","oferta studi√≥w","",""],
["das Studium abschlie√üen","uko≈Ñczyƒá studia","",""],
["die Tourismusbranche","bran≈ºa turystyczna","",""],
["die Touristikagentur","agencja turystyczna","",""],
["Unterkunft und Verpflegung","nocleg i wy≈ºywienie","",""],
["die Versicherung","ubezpieczenie","",""],
["der Vorteil","zaleta","",""],
["der Wandel","zmiana, przemiana","",""],
["der Zukunftsplan","plan na przysz≈Ço≈õƒá","",""]
];

// rest of the code unchanged
let difficult = []; // lista trudnych s≈Ç√≥wek

let current = 0;

// -------------------------
// GENEROWANIE MENU
// -------------------------
function showMenu() {
    app.innerHTML = `
        <h2>MENU G≈Å√ìWNE</h2>
        <button onclick="startLearning()">üìò Nauka</button>
        <button onclick="startQuiz()">üß© Quiz ‚Äì 4 opcje</button>
        <button onclick="startTest()">‚úç Test ‚Äì wpisywanie</button>
        <button onclick="startDifficult()">‚ö† Powt√≥rka trudnych</button>
        <button onclick="startEasy()">üòä Tryb ≈Çatwy</button>
        <button onclick="startSpaced()">‚è≥ Powt√≥rki inteligentne</button>
        <button onclick="startInterleave()">üîÄ Mieszany tryb nauki</button>
        <button onclick="startQuizCard()">üìù Kartk√≥wka</button>
    `;
}

// -------------------------
// FUNKCJE POMOCNICZE
// -------------------------
function randomWord(list = words) {
    current = Math.floor(Math.random() * list.length);
    return list[current];
}

// Helper to add a German character to input field
function addGermanChar(char, inputId) {
    const input = document.getElementById(inputId);
    if (input) {
        // Insert char at cursor position
        const start = input.selectionStart;
        const end = input.selectionEnd;
        const value = input.value;
        input.value = value.substring(0, start) + char + value.substring(end);
        // Move cursor after inserted char
        input.selectionStart = input.selectionEnd = start + char.length;
        input.focus();
    }
}

// -------------------------
// TRYB 1 ‚Äî NAUKA
// -------------------------
function startLearning() {
    const w = randomWord();
    app.innerHTML = `
        <h2>üìò Nauka</h2>
        <div class="word">${w[1]}</div>
        <div class="small">T≈Çumaczenie:</div>
        <div class="translation">${w[0]}</div>

        <button onclick="startLearning()">Nastƒôpne s≈Ç√≥wko</button>
        <button onclick="markDifficult('${w[0]}')">Dodaj do trudnych</button>
        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}

function markDifficult(word) {
    if (!difficult.includes(word)) difficult.push(word);
    alert("Dodano do trudnych ‚úî");
}

// -------------------------
// TRYB 2 ‚Äî QUIZ
// -------------------------
function startQuiz() {
    const w = randomWord();
    const correct = w[0];

    let answers = [correct];
    while (answers.length < 4) {
        const r = words[Math.floor(Math.random() * words.length)][0];
        if (!answers.includes(r)) answers.push(r);
    }
    answers.sort(() => Math.random() - 0.5);

    app.innerHTML = `
        <h2>üß© Quiz ‚Äì wybierz</h2>
        <div class="word">${w[1]}</div>

        ${answers.map(a => `<button class="option" onclick="checkAnswer(this,'${correct}')">${a}</button>`).join("")}

        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}

function checkAnswer(btn, correct) {
    if (btn.innerText === correct) {
        btn.classList.add("correct");
        // find current word object
        const wObj = words.find(w => w[0] === correct);
        showIntelligentBox(wObj, startQuiz);
    } else {
        btn.classList.add("wrong");
    }
}

// -------------------------
// TRYB 3 ‚Äî TEST
// -------------------------
function startTest() {
    const w = randomWord();
    app.innerHTML = `
        <h2>‚úç Test</h2>
        <div class="word">${w[1]}</div>
        <div style="margin-bottom: 8px;">
            <button type="button" style="width:40px;padding:8px 0;margin:2px 3px 8px 3px;font-size:18px;" onclick="addGermanChar('√§','inputTest')">√§</button>
            <button type="button" style="width:40px;padding:8px 0;margin:2px 3px 8px 3px;font-size:18px;" onclick="addGermanChar('√∂','inputTest')">√∂</button>
            <button type="button" style="width:40px;padding:8px 0;margin:2px 3px 8px 3px;font-size:18px;" onclick="addGermanChar('√º','inputTest')">√º</button>
            <button type="button" style="width:40px;padding:8px 0;margin:2px 3px 8px 3px;font-size:18px;" onclick="addGermanChar('√ü','inputTest')">√ü</button>
        </div>
        <input id="inputTest" type="text" placeholder="Twoja odpowied≈∫" style="padding:10px;width:90%;font-size:18px;">
        <button onclick="checkTestAnswer('${w[0]}')">Sprawd≈∫</button>
        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}

function checkTestAnswer(correct) {
    const user = document.getElementById("inputTest").value.trim().toLowerCase();
    const wObj = words.find(w => w[0] === correct);

    if (user === correct.toLowerCase()) {
        showIntelligentBox(wObj, startTest);
    } else {
        alert("‚ùå ≈πLE!\nPoprawna odpowied≈∫: " + correct);
    }
}

// -------------------------
// TRYB 4 ‚Äî TRUDNE
// -------------------------
function startDifficult() {
    if (difficult.length === 0) {
        alert("Nie masz trudnych s≈Ç√≥wek!");
        return showMenu();
    }

    const found = words.find(w => w[0] === difficult[Math.floor(Math.random() * difficult.length)]);

    app.innerHTML = `
        <h2>‚ö† Trudne s≈Çowa</h2>
        <div class="word">${found[1]}</div>
        <div class="translation">${found[0]}</div>
        <div class="example">${found[3]}</div>

        <button onclick="startDifficult()">Nastƒôpne</button>
        <button onclick="removeDifficult('${found[0]}')">Usu≈Ñ z trudnych</button>
        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}

function removeDifficult(w) {
    difficult = difficult.filter(x => x !== w);
    alert("Usuniƒôto ‚úî");
    startDifficult();
}

// -------------------------
// TRYB 5 ‚Äî ≈ÅATWE
// -------------------------
function startEasy() {
    const easyList = words.slice(0, 10);
    const w = randomWord(easyList);

    app.innerHTML = `
        <h2>üòä Tryb ≈Çatwy</h2>
        <div class="word">${w[1]}</div>
        <div class="translation">${w[0]}</div>
        <div class="example">${w[3]}</div>

        <button onclick="startEasy()">Nastƒôpne</button>
        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}
// -------------------------
// ZAAWANSOWANE METODY NAUKI
// -------------------------
var stats = {
    scores: {},
    history: []
};

function spacedRepetitionPick() {
    const difficultyWeights = words.map(w => {
        const score = stats.scores[w[0]] || 0;
        return Math.max(1, 10 - score);
    });
    const total = difficultyWeights.reduce((a,b)=>a+b,0);
    let r = Math.random() * total;
    for (let i=0;i<words.length;i++){
        if (r < difficultyWeights[i]) return words[i];
        r -= difficultyWeights[i];
    }
    return words[0];
}

function startSpaced() {
    const w = spacedRepetitionPick();
    current = words.indexOf(w);
    app.innerHTML = `
        <h2>‚è≥ Powt√≥rki inteligentne</h2>
        <div class="word">${w[1]}</div>
        <button onclick="showSpacedAnswer('${w[0]}')">Poka≈º odpowied≈∫</button>
        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}

function showSpacedAnswer(correct) {
    const w = words[current];
    app.innerHTML = `
        <h2>‚è≥ Spaced Repetition</h2>
        <div class="word">${w[1]}</div>
        <div class="translation">${correct}</div>
        <button onclick="rateSpaced(1)">‚ùå Trudne</button>
        <button onclick="rateSpaced(2)">üëå OK</button>
        <button onclick="rateSpaced(3)">‚úî ≈Åatwe</button>
        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}

function rateSpaced(level){
    const key = words[current][0];
    if (!stats.scores[key]) stats.scores[key] = 0;
    stats.scores[key] += (level - 2); 
    if (stats.scores[key] < 0) stats.scores[key] = 0;
    startSpaced();
}

function startInterleave() {
    const w = randomWord();
    const type = Math.random() < 0.5 ? 'mc' : 'write';
    if (type === 'mc') {
        startQuiz();
    } else {
        startTest();
    }
}

// -------------------------
// INTELLIGENT FEEDBACK BOX
// -------------------------
function showIntelligentBox(wordObj, callback) {
    // Create overlay div
    const overlay = document.createElement('div');
    overlay.id = 'intelligentBoxOverlay';

    // Create box div
    const box = document.createElement('div');
    box.id = 'intelligentBox';

    // Content inside box: German word, Polish translation, additional info placeholder
    box.innerHTML = `
        <div class="word">${wordObj[1]}</div>
        <div class="translation">${wordObj[0]}</div>
    `;

    overlay.appendChild(box);
    document.body.appendChild(overlay);

    setTimeout(() => {
        document.body.removeChild(overlay);
        if (typeof callback === 'function') callback();
    }, 3500);
}

// -------------------------
// TRYB 6 ‚Äî KARTK√ìWKA
// -------------------------
let quizCardWords = [];
let quizCardIndex = 0;
let quizCardScore = 0;

function startQuizCard() {
    const minWords = 20;
    const maxWords = 20;
    const count = Math.min(words.length, Math.floor(Math.random() * (maxWords - minWords + 1)) + minWords);
    // Shuffle words and slice count
    quizCardWords = words.slice().sort(() => 0.5 - Math.random()).slice(0, count);
    quizCardIndex = 0;
    quizCardScore = 0;
    nextQuizCard();
}

function nextQuizCard() {
    if (quizCardIndex >= quizCardWords.length) {
        showCardResult();
        return;
    }
    const w = quizCardWords[quizCardIndex];
    // Randomly decide quiz or input test
    const mode = Math.random() < 0.5 ? 'quiz' : 'test';
    if (mode === 'quiz') {
        const correct = w[0];
        let answers = [correct];
        while (answers.length < 4) {
            const r = words[Math.floor(Math.random() * words.length)][0];
            if (!answers.includes(r)) answers.push(r);
        }
        answers.sort(() => Math.random() - 0.5);
        app.innerHTML = `
            <h2>üìù Kartk√≥wka (${quizCardIndex+1}/${quizCardWords.length}) - Quiz</h2>
            <div class="word">${w[1]}</div>
            ${answers.map(a => `<button class="option" onclick="checkAnswerCard(this,'${correct}')">${a}</button>`).join("")}
            <button class="back" onclick="showMenu()">‚è™ Menu</button>
        `;
    } else {
        renderQuizCardTest(w, quizCardIndex, quizCardWords.length);
    }
}

function renderQuizCardTest(w, idx, total) {
    app.innerHTML = `
        <h2>üìù Kartk√≥wka (${idx+1}/${total}) - Test</h2>
        <div class="word">${w[1]}</div>
        <div style="margin-bottom: 8px;">
            <button type="button" style="width:40px;padding:8px 0;margin:2px 3px 8px 3px;font-size:18px;" onclick="addGermanChar('√§','inputQuizCard')">√§</button>
            <button type="button" style="width:40px;padding:8px 0;margin:2px 3px 8px 3px;font-size:18px;" onclick="addGermanChar('√∂','inputQuizCard')">√∂</button>
            <button type="button" style="width:40px;padding:8px 0;margin:2px 3px 8px 3px;font-size:18px;" onclick="addGermanChar('√º','inputQuizCard')">√º</button>
            <button type="button" style="width:40px;padding:8px 0;margin:2px 3px 8px 3px;font-size:18px;" onclick="addGermanChar('√ü','inputQuizCard')">√ü</button>
        </div>
        <input id="inputQuizCard" type="text" placeholder="Twoja odpowied≈∫" style="padding:10px;width:90%;font-size:18px;">
        <button onclick="checkTestAnswerCard('${w[0]}')">Sprawd≈∫</button>
        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}

function checkAnswerCard(btn, correct) {
    if (btn.innerText === correct) {
        btn.classList.add("correct");
        quizCardScore++;
    } else {
        btn.classList.add("wrong");
    }
    // przejd≈∫ do nastƒôpnego s≈Ç√≥wka po kr√≥tkiej przerwie
    setTimeout(() => {
        quizCardIndex++;
        nextQuizCard();
    }, 500);
}

function checkTestAnswerCard(correct) {
    const user = document.getElementById("inputQuizCard").value.trim().toLowerCase();
    if (user === correct.toLowerCase()) {
        quizCardScore++;
    }
    // niezale≈ºnie od wyniku przejd≈∫ do nastƒôpnego s≈Ç√≥wka po kr√≥tkiej przerwie
    setTimeout(() => {
        quizCardIndex++;
        nextQuizCard();
    }, 500);
}

function showCardResult() {
    const total = quizCardWords.length;
    const percent = ((quizCardScore / total) * 100).toFixed(1);
    app.innerHTML = `
        <h2>üìù Kartk√≥wka - Wynik</h2>
        <div class="small">Poprawne odpowiedzi: <strong>${quizCardScore}</strong> / ${total}</div>
        <div class="small">Procent: <strong>${percent}%</strong></div>
        <button onclick="startQuizCard()">üîÑ Spr√≥buj ponownie</button>
        <button class="back" onclick="showMenu()">‚è™ Menu</button>
    `;
}

// Start aplikacji
showMenu();
</script>
</body>
</html>
